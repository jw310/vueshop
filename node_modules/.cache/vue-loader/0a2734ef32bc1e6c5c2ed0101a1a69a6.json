{"remainingRequest":"/Users/lchick1003/Documents/vue3esite/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lchick1003/Documents/vue3esite/src/views/Coupons.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lchick1003/Documents/vue3esite/src/views/Coupons.vue","mtime":1575280347000},{"path":"/Users/lchick1003/Documents/vue3esite/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lchick1003/Documents/vue3esite/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lchick1003/Documents/vue3esite/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lchick1003/Documents/vue3esite/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport $ from \"jquery\"; // 因為此元件無法使用 $ ，所以要先 import 才能使用\n\nexport default {\n  data() {\n    return {\n      Coupons: [],\n      pagination: {},\n      couponId: '', \n      tempCoupon: {}, // 暫存資料\n      isNew: false,\n      isLoading: false, // 讀取效果     \n    };   \n  },\n  methods: {\n    getCoupons(page = 1) {\n      const vm = this;\n      const api = 'https://vue-course-api.hexschool.io/api/jw310/admin/coupons?page=${page}'\n      //const api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupons?page=${page}`;\n      vm.isLoading = true;\n      this.$http.get(api).then(response => {\n        console.log(response.data);   // api 回覆訊息\n        vm.isLoading = false;\n        vm.Coupons = response.data.coupons;\n        vm.pagination = response.data.pagination; // 分頁資訊\n        console.log(vm.Coupons);\n      });\n    },\n    updateCoupon() {\n      let api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon`;\n      let httpMethod = \"post\";\n      const vm = this;\n      if (!vm.isNew) {\n        api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`;\n        httpMethod = \"put\";\n      }\n      this.$http[httpMethod](api, { data: vm.tempCoupon }).then(response => {\n      //console.log(response.data);\n        if (response.data.success) {\n          $(\"#couponModal\").modal(\"hide\"); // 成功地關閉 modal\n          vm.getCoupons();\n        } else {\n          $(\"#couponModal\").modal(\"hide\"); // 成功地關閉 modal\n          vm.getCoupons();\n          console.log(\"新增失敗\");\n        }\n      });\n    },\n    openModal(isNew, item) {\n      if (isNew) {\n        this.tempCoupon = {};\n        this.isNew = true;\n      } else {\n        // ES6 方法 Object.assign()\n        this.tempCoupon = Object.assign({}, item);  // 處理物件傳參考的問題\n        this.isNew = false;\n      }\n      $(\"#couponModal\").modal(\"show\");\n    },\n    deleteCoupons() {\n      const vm = this;\n      //console.log(vm.index);\n      const api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.couponId}`;\n      this.$http.delete(api).then(response => {\n      //console.log(response.data);\n        if (response.data.success) {\n          $(\"#delcouponModal\").modal(\"hide\"); // 成功地關閉 modal\n          console.log(\"刪除成功\");\n          vm.getCoupons();\n        } else {\n          $(\"#delcouponModal\").modal(\"hide\"); // 成功地關閉 modal\n          vm.getCoupons();\n          console.log(\"刪除失敗\");\n        }\n      });\n    },\n    delModal(item) {\n      $(\"#delcouponModal\").modal(\"show\");\n      this.couponId = item.id; // 取得點選的 item.id\n      //console.log(item.id);\n    },\n    signout() {\n   //  對應 config 裡的 dev.env.js 的環境變數\n   //const api = 'https://vue-course-api.hexschool.io/logout';\n   const api = `${process.env.VUE_APP_APIPATH}/logout` ;\n   // api 伺服器路徑\n   // 申請apipath\n   const vm = this;\n   this.$http.post(api).then((response) => {\n   console.log(response.data);\n   if (response.data.success) {\n          vm.$router.push('/login');    // 登入回到首頁\n        } \n      });\n    },\n  },\n  created() {\n    this.getCoupons();\n  }\n};\n",{"version":3,"sources":["Coupons.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkMA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Coupons.vue","sourceRoot":"src/views","sourcesContent":["<template>\n<div>\n    <loading :active.sync=\"isLoading\"></loading>\n         <nav class=\"navbar navbar-expand-lg navbar-light bg-light\">\n      <h6 class=\"d-flex justify-content-between align-items-center mt-4 mb-4 text-muted\">\n              <span>管理介面</span>\n              <a class=\"d-flex align-items-center text-muted\" href=\"#\">\n                <span data-feather=\"plus-circle\"></span>\n              </a>\n            </h6>\n            <ul class=\"nav flex-column\">\n              <li class=\"nav-item\">\n              <router-link class=\"nav-link\" to=\"/admin/products\">\n                  產品列表\n                </router-link>\n              </li>\n            </ul>\n            <ul class=\"nav flex-column\">\n              <li class=\"nav-item\">\n                <router-link class=\"nav-link\" to=\"/admin/orders\">\n                  訂單列表\n                </router-link>\n              </li>\n            </ul>\n            <ul class=\"nav flex-column\">\n              <li class=\"nav-item\">\n                <router-link class=\"nav-link\" to=\"/admin/coupons\">\n                  優惠券\n                </router-link>\n              </li>\n            </ul>\n            <ul class=\"nav flex-column\">\n              <li class=\"nav-item\">\n                <a href=\"#\" @click.prevent=\"signout\">登出</a>\n              </li>\n            </ul>\n    <div class=\"text-right mt-1\">\n    <!-- 傳值讓  isNew = true -->\n    </div>\n    </nav>\n    <!-- <span>優惠券列表</span> -->\n    <button class=\"btn btn-primary\" @click=\"openModal(true)\">建立新優惠券</button>\n    <table class=\"table mt-4\">\n      <thead>\n        <tr>\n          <th>優惠名稱</th>\n          <th>優惠碼</th>\n          <th>折扣\b%數</th>\n          <th>到期日</th>\n          <th>是否啟用</th>\n          <th>編輯</th>\n        </tr>\n      </thead>\n      <tbody>\n        <!--key 會產生警告(有 eslint 的話)，因為此時沒有資料，但不影響使用-->\n        <tr v-for=\"(item, key) in Coupons\" :key=\"item.id\">\n          <td>{{item.title}}</td>\n          <td>{{item.code}}</td>\n          <td>{{item.percent}}</td>\n          <td>{{item.dua_date}}</td>\n          <td>\n            <span v-if=\"item.is_enabled\" class=\"text-success\">啟用</span>\n            <span v-else>未啟用</span>\n          </td>\n          <td>\n              <div style=\"display: inline-block;width: 100px;\">\n              <button class=\"btn btn-outline-primary btn-sm\" @click=\"openModal(false, item)\">編輯</button>\n              <button class=\"btn btn-outline-primary btn-sm\" @click=\"delModal(item)\">刪除</button>\n              </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <!--page-->\n        <nav aria-label=\"Page navigation example\">\n      <ul class=\"pagination\">\n        <li class=\"page-item\" :class=\"{'disable': !pagination.has_pre}\">\n          <a\n            class=\"page-link\"\n            href=\"#\"\n            aria-label=\"Previous\"\n            @click.prevent=\"getProducts(pagination.current_page - 1)\"\n          >\n            <span aria-hidden=\"true\">&laquo;</span>\n            <span class=\"sr-only\">Previous</span>\n          </a>\n        </li>\n        <li\n          class=\"page-item\"\n          v-for=\"page in pagination.total_pages\"\n          :key=\"page\"\n          :class=\"{'active': pagination.current_page === page}\"\n        >\n          <a class=\"page-link\" href=\"#\" @click.prevent=\"getProducts(page)\">{{ page }}</a>\n        </li>\n        <li class=\"page-item\">\n          <a\n            class=\"page-link\"\n            href=\"#\"\n            aria-label=\"Next\"\n            @click.prevent=\"getProducts(pagination.current_page + 1)\"\n          >\n            <span aria-hidden=\"true\">&raquo;</span>\n            <span class=\"sr-only\">Next</span>\n          </a>\n        </li>\n      </ul>\n    </nav>\n        <!-- openModal -->\n    <div class=\"modal fade\" id=\"couponModal\" tabindex=\"-1\" role=\"dialog\"\n         aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\"> \n      <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <div class=\"modal-content border-0\">\n            <div class=\"modal-header bg-dark text-white\">\n                <h5 class=\"modal-title\" id=\"exampleModalLabel\">\n                <span>新增優惠券</span>\n                </h5>            \n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">   \n                <div class=\"row\">\n                    <div class=\"col-sm-12\">\n                        <div class=\"form-group\">\n                        <label for=\"title\">優惠名稱</label>\n                        <input type=\"text\" class=\"form-control\" id=\"title\"\n                        v-model=\"tempCoupon.title\" placeholder=\"請輸入優惠名稱\"/>\n                        </div>\n                        <div class=\"form-group\">\n                        <label for=\"code\">優惠碼</label>\n                        <input type=\"text\" class=\"form-control\" id=\"code\"\n                         v-model=\"tempCoupon.code\" placeholder=\"請輸入優惠碼\"/>\n                        </div>\n                            <div class=\"form-row\">\n                                <div class=\"form-group col-md-6\">\n                                <label for=\"percent\">折扣％數</label>\n                                <input type=\"text\" class=\"form-control\" id=\"percent\"\n                                v-model=\"tempCoupon.percent\" placeholder=\"請輸入折扣％數\"/>\n                                </div>                     \n                                <div class=\"form-group col-md-6\">\n                                <label for=\"percent\">到期日</label>\n                                 <date-picker v-model=\"tempCoupon.dua_date\" :config=\"{format: 'DD/MM/YYYY'}\"></date-picker>\n                                </div>                               \n                            </div>\n                            <div class=\"form-group\">\n                                <div class=\"form-check\">\n                                <input class=\"form-check-input\" type=\"checkbox\"\n                                v-model=\"tempCoupon.is_enabled\"\n                                :true-value=\"1\"\n                                :false-value=\"0\"\n                                id=\"is_enabled\"/>\n                                <label class=\"form-check-label\" for=\"is_enabled\">是否啟用</label>\n                                </div>\n                            </div>\n                     </div>  \n                </div>\n            </div>  \n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn btn-outline-secondary\" data-dismiss=\"modal\">取消</button>\n                        <button type=\"button\" class=\"btn btn-primary\" @click=\"updateCoupon\">確認</button>\n                    </div>\n        </div>\n      </div>\n    </div> \n    <!--delmodal-->\n    <div class=\"modal fade\" id=\"delcouponModal\" tabindex=\"-1\" role=\"dialog\"\n      aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content border-0\">\n          <div class=\"modal-header bg-danger text-white\">\n            <h5 class=\"modal-title\" id=\"exampleModalLabel\">\n              <span>刪除產品</span>\n            </h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            是否刪除\n            <strong class=\"text-danger\">{{ tempCoupon.title }}</strong> 商品(刪除後將無法恢復)。\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-outline-secondary\" data-dismiss=\"modal\">取消</button>\n            <button type=\"button\" class=\"btn btn-danger\" @click=\"deleteCoupons\">確認刪除</button>\n          </div>\n        </div>\n      </div>\n    </div>\n          \n</div> \n</template> \n\n<script>\nimport $ from \"jquery\"; // 因為此元件無法使用 $ ，所以要先 import 才能使用\n\nexport default {\n  data() {\n    return {\n      Coupons: [],\n      pagination: {},\n      couponId: '', \n      tempCoupon: {}, // 暫存資料\n      isNew: false,\n      isLoading: false, // 讀取效果     \n    };   \n  },\n  methods: {\n    getCoupons(page = 1) {\n      const vm = this;\n      const api = 'https://vue-course-api.hexschool.io/api/jw310/admin/coupons?page=${page}'\n      //const api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupons?page=${page}`;\n      vm.isLoading = true;\n      this.$http.get(api).then(response => {\n        console.log(response.data);   // api 回覆訊息\n        vm.isLoading = false;\n        vm.Coupons = response.data.coupons;\n        vm.pagination = response.data.pagination; // 分頁資訊\n        console.log(vm.Coupons);\n      });\n    },\n    updateCoupon() {\n      let api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon`;\n      let httpMethod = \"post\";\n      const vm = this;\n      if (!vm.isNew) {\n        api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`;\n        httpMethod = \"put\";\n      }\n      this.$http[httpMethod](api, { data: vm.tempCoupon }).then(response => {\n      //console.log(response.data);\n        if (response.data.success) {\n          $(\"#couponModal\").modal(\"hide\"); // 成功地關閉 modal\n          vm.getCoupons();\n        } else {\n          $(\"#couponModal\").modal(\"hide\"); // 成功地關閉 modal\n          vm.getCoupons();\n          console.log(\"新增失敗\");\n        }\n      });\n    },\n    openModal(isNew, item) {\n      if (isNew) {\n        this.tempCoupon = {};\n        this.isNew = true;\n      } else {\n        // ES6 方法 Object.assign()\n        this.tempCoupon = Object.assign({}, item);  // 處理物件傳參考的問題\n        this.isNew = false;\n      }\n      $(\"#couponModal\").modal(\"show\");\n    },\n    deleteCoupons() {\n      const vm = this;\n      //console.log(vm.index);\n      const api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.couponId}`;\n      this.$http.delete(api).then(response => {\n      //console.log(response.data);\n        if (response.data.success) {\n          $(\"#delcouponModal\").modal(\"hide\"); // 成功地關閉 modal\n          console.log(\"刪除成功\");\n          vm.getCoupons();\n        } else {\n          $(\"#delcouponModal\").modal(\"hide\"); // 成功地關閉 modal\n          vm.getCoupons();\n          console.log(\"刪除失敗\");\n        }\n      });\n    },\n    delModal(item) {\n      $(\"#delcouponModal\").modal(\"show\");\n      this.couponId = item.id; // 取得點選的 item.id\n      //console.log(item.id);\n    },\n    signout() {\n   //  對應 config 裡的 dev.env.js 的環境變數\n   //const api = 'https://vue-course-api.hexschool.io/logout';\n   const api = `${process.env.VUE_APP_APIPATH}/logout` ;\n   // api 伺服器路徑\n   // 申請apipath\n   const vm = this;\n   this.$http.post(api).then((response) => {\n   console.log(response.data);\n   if (response.data.success) {\n          vm.$router.push('/login');    // 登入回到首頁\n        } \n      });\n    },\n  },\n  created() {\n    this.getCoupons();\n  }\n};\n</script>\n\n"]}]}